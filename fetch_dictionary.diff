#include <stdlib.h>
#include <string.h>
#include <curl/curl.h>
#include <time.h>
#include <ctype.h>
=======
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <ctype.h>
>>>>>>> REPLACE

<<<<<<< SEARCH
int main(void)
{
    CURL *curl_handle;
    CURLcode res;

    struct MemoryStruct chunk;

    chunk.memory = malloc(1);  // initial memory allocation
    chunk.size = 0;            // no data at this point

    curl_global_init(CURL_GLOBAL_ALL);

    curl_handle = curl_easy_init();
    if(!curl_handle) {
        fprintf(stderr, "Failed to initialize curl\n");
        return 1;
    }

    // English words list URL
    const char *url = "https://raw.githubusercontent.com/dwyl/english-words/master/words.txt";

    curl_easy_setopt(curl_handle, CURLOPT_URL, url);
    curl_easy_setopt(curl_handle, CURLOPT_WRITEFUNCTION, WriteMemoryCallback);
    curl_easy_setopt(curl_handle, CURLOPT_WRITEDATA, (void *)&chunk);
    curl_easy_setopt(curl_handle, CURLOPT_USERAGENT, "libcurl-agent/1.0");

    res = curl_easy_perform(curl_handle);

    if(res != CURLE_OK) {
        fprintf(stderr, "curl_easy_perform() failed: %s\n",
                curl_easy_strerror(res));
    }
    else {
        // Process the downloaded data line by line and build the word list array
        size_t word_capacity = 10000;
        char **words = malloc(word_capacity * sizeof(char *));
        if (!words) {
            fprintf(stderr, "Failed to allocate memory for words array\n");
            free(chunk.memory);
            curl_easy_cleanup(curl_handle);
            curl_global_cleanup();
            return 1;
        }
        size_t word_count = 0;

        char *line = NULL;
        char *saveptr = NULL;
        line = strtok_r(chunk.memory, "\n", &saveptr);
        while (line != NULL) {
            if (strlen(line) == 5) {
                // Check if all letters
                int valid = 1;
                for (int i = 0; i < 5; i++) {
                    if (!isalpha(line[i])) {
                        valid = 0;
                        break;
                    }
                }
                if (valid) {
                    // Store lowercase copy
                    char *w = malloc(6);
                    if (!w) {
                        fprintf(stderr, "Failed to allocate memory for word\n");
                        break;
                    }
                    for (int i = 0; i < 5; i++) {
                        w[i] = tolower((unsigned char)line[i]);
                    }
                    w[5] = '\0';

                    if (word_count >= word_capacity) {
                        word_capacity *= 2;
                        char **tmp = realloc(words, word_capacity * sizeof(char *));
                        if (!tmp) {
                            fprintf(stderr, "Failed to reallocate words array\n");
                            free(w);
                            break;
                        }
                        words = tmp;
                    }

                    words[word_count++] = w;
                }
            }
        line = strtok_r(NULL, "\n", &saveptr);
    }

    if (word_count == 0) {
        fprintf(stderr, "No valid 5-letter words loaded\n");
        free(chunk.memory);
        curl_easy_cleanup(curl_handle);
        curl_global_cleanup();
        return 1;
    }

    srand((unsigned int)time(NULL));
    const char *target = words[rand() % word_count];

    printf("Welcome to Wordle!\n");
    printf("Guess the 5-letter word. You have %d attempts.\n", 6);

    char guess[7]; // 5 letters + newline + null terminator
    for (int attempt = 1; attempt <= 6; attempt++) {
        printf("Attempt %d: ", attempt);
        if (fgets(guess, sizeof(guess), stdin) == NULL) {
            printf("\nError reading input. Exiting.\n");
            break;
        }

        size_t len = strlen(guess);
        if (len > 0 && guess[len-1] == '\n') {
            guess[len-1] = '\0';
            len--;
        }

        if (len != 5) {
            printf("Your guess must be exactly 5 letters.\n");
            attempt--;
            continue;
        }

        strtolower(guess);

        int valid = 1;
        for (int i = 0; i < 5; i++) {
            if (!isalpha(guess[i])) {
                valid = 0;
                break;
            }
        }
        if (!valid) {
            printf("Your guess must contain only letters.\n");
            attempt--;
            continue;
        }

        char feedback[6];
        generate_feedback(target, guess, feedback);
        printf("%s  Feedback: %s\n", guess, feedback);

        if (strcmp(guess, target) == 0) {
            printf("Congratulations! You guessed the word in %d attempts.\n", attempt);
            break;
        }

        if (attempt == 6) {
            printf("Game over! The correct word was: %s\n", target);
        }
    }

    for (size_t i = 0; i < word_count; i++) {
        free(words[i]);
    }
    free(words);

    // cleanup curl stuffA
    curl_easy_cleanup(curl_handle);
    free(chunk.memory);
    curl_global_cleanup();

    return 0;
}
=======
int main(void)
{
    // Instead of downloading, read from local file "words.txt"
    FILE *file = fopen("words.txt", "r");
    if (!file) {
        fprintf(stderr, "Failed to open words.txt. Please ensure the file is in the current directory.\n");
        return 1;
    }

    size_t word_capacity = 10000;
    char **words = malloc(word_capacity * sizeof(char *));
    if (!words) {
        fprintf(stderr, "Failed to allocate memory for words array\n");
        fclose(file);
        return 1;
    }
    size_t word_count = 0;

    char line[256];
    while (fgets(line, sizeof(line), file) != NULL) {
        size_t len = strlen(line);
        if (len > 0 && (line[len - 1] == '\n' || line[len - 1] == '\r')) {
            line[len - 1] = '\0';
            len--;
        }
        if (len == 5) {
            // Check if all letters
            int valid = 1;
            for (int i = 0; i < 5; i++) {
                if (!isalpha(line[i])) {
                    valid = 0;
                    break;
                }
            }
            if (valid) {
                // Store lowercase copy
                char *w = malloc(6);
                if (!w) {
                    fprintf(stderr, "Failed to allocate memory for word\n");
                    break;
                }
                for (int i = 0; i < 5; i++) {
                    w[i] = tolower((unsigned char)line[i]);
                }
                w[5] = '\0';

                if (word_count >= word_capacity) {
                    word_capacity *= 2;
                    char **tmp = realloc(words, word_capacity * sizeof(char *));
                    if (!tmp) {
                        fprintf(stderr, "Failed to reallocate words array\n");
                        free(w);
                        break;
                    }
                    words = tmp;
                }

                words[word_count++] = w;
            }
        }
    }

    fclose(file);

    if (word_count == 0) {
        fprintf(stderr, "No valid 5-letter words loaded\n");
        for (size_t i = 0; i < word_count; i++) {
            free(words[i]);
        }
        free(words);
        return 1;
    }

    srand((unsigned int)time(NULL));
    const char *target = words[rand() % word_count];

    printf("Welcome to Wordle!\n");
    printf("Guess the 5-letter word. You have %d attempts.\n", 6);

    char guess[7]; // 5 letters + newline + null terminator
    for (int attempt = 1; attempt <= 6; attempt++) {
        printf("Attempt %d: ", attempt);
        if (fgets(guess, sizeof(guess), stdin) == NULL) {
            printf("\nError reading input. Exiting.\n");
            break;
        }

        size_t len = strlen(guess);
        if (len > 0 && guess[len-1] == '\n') {
            guess[len-1] = '\0';
            len--;
        }

        if (len != 5) {
            printf("Your guess must be exactly 5 letters.\n");
            attempt--;
            continue;
        }

        strtolower(guess);

        int valid = 1;
        for (int i = 0; i < 5; i++) {
            if (!isalpha(guess[i])) {
                valid = 0;
                break;
            }
        }
        if (!valid) {
            printf("Your guess must contain only letters.\n");
            attempt--;
            continue;
        }

        char feedback[6];
        generate_feedback(target, guess, feedback);
        printf("%s  Feedback: %s\n", guess, feedback);

        if (strcmp(guess, target) == 0) {
            printf("Congratulations! You guessed the word in %d attempts.\n", attempt);
            break;
        }

        if (attempt == 6) {
            printf("Game over! The correct word was: %s\n", target);
        }
    }

    for (size_t i = 0; i < word_count; i++) {
        free(words[i]);
    }
    free(words);

    return 0;
}
